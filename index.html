<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Calculator</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f4f4f4;
            color: #333;
        }

        #calculator {
            background-color: #282c34;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            width: 320px;
            overflow: hidden;
            display: grid;
            grid-template-rows: auto 1fr; /* Display row and buttons row */
        }

        #calculator-display {
            background-color: #1c1e22;
            color: #ffffff;
            font-size: 3em;
            padding: 20px;
            text-align: right;
            border-top-left-radius: 15px;
            border-top-right-radius: 15px;
            word-wrap: break-word;
            word-break: break-all;
            min-height: 60px;
            display: flex;
            align-items: flex-end;
            justify-content: flex-end;
        }

        #calculator-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1px; /* Small gap between buttons */
            background-color: #1c1e22; /* To make gap lines visible */
            padding: 1px; /* Padding for the entire button grid */
        }

        #calculator-buttons button {
            background-color: #3c4048;
            color: #ffffff;
            border: none;
            padding: 20px 0;
            font-size: 1.8em;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            outline: none;
            border-radius: 0; /* Buttons will form a seamless grid */
        }

        #calculator-buttons button:hover {
            background-color: #555c66;
        }

        #calculator-buttons button:active {
            transform: scale(0.98);
        }

        .operator {
            background-color: #f7923b; /* Orange for operators */
        }

        .operator:hover {
            background-color: #ffad60;
        }

        .clear {
            background-color: #a6a6a6; /* Grey for clear */
        }

        .clear:hover {
            background-color: #c0c0c0;
        }

        .equals {
            background-color: #4CAF50; /* Green for equals */
        }

        .equals:hover {
            background-color: #6dbe70;
        }

        /* Grid specific styling for buttons */
        .wide {
            grid-column: span 2;
        }

        /* Rounding specific buttons for overall calculator shape */
        #calculator-buttons button:nth-child(1) { border-top-left-radius: 0; } /* C button */
        #calculator-buttons button:nth-child(4) { border-top-right-radius: 0; } /* / button */
        #calculator-buttons button:nth-child(17) { border-bottom-left-radius: 15px; } /* 0 button */
        #calculator-buttons button:nth-child(19) { border-bottom-right-radius: 15px; } /* = button */

        /* Re-adjusting specific button positions for new layout */
        /* C, √, %, / */
        /* 7, 8, 9, * */
        /* 4, 5, 6, - */
        /* 1, 2, 3, + */
        /* 0, ., = */

        #clear-button { grid-column: 1; grid-row: 1; }
        .operator[data-operator="sqrt"] { grid-column: 2; grid-row: 1; }
        .operator[data-operator="%"] { grid-column: 3; grid-row: 1; }
        .operator[data-operator="/"] { grid-column: 4; grid-row: 1; }

        .number:nth-child(5) { grid-column: 1; grid-row: 2; } /* 7 */
        .number:nth-child(6) { grid-column: 2; grid-row: 2; } /* 8 */
        .number:nth-child(7) { grid-column: 3; grid-row: 2; } /* 9 */
        .operator[data-operator="*"] { grid-column: 4; grid-row: 2; }

        .number:nth-child(9) { grid-column: 1; grid-row: 3; } /* 4 */
        .number:nth-child(10) { grid-column: 2; grid-row: 3; } /* 5 */
        .number:nth-child(11) { grid-column: 3; grid-row: 3; } /* 6 */
        .operator[data-operator="-"] { grid-column: 4; grid-row: 3; }

        .number:nth-child(13) { grid-column: 1; grid-row: 4; } /* 1 */
        .number:nth-child(14) { grid-column: 2; grid-row: 4; } /* 2 */
        .number:nth-child(15) { grid-column: 3; grid-row: 4; } /* 3 */
        .operator[data-operator="+"] { grid-column: 4; grid-row: 4; }

        .number:nth-child(17) { grid-column: 1 / span 2; grid-row: 5; } /* 0 spans 2 columns */
        .number.decimal { grid-column: 3; grid-row: 5; } /* . */
        #equals-button { grid-column: 4; grid-row: 5; }
    </style>
</head>
<body>
    <div id="calculator">
        <div id="calculator-display">0</div>
        <div id="calculator-buttons">
            <button class="clear" id="clear-button">C</button>
            <button class="operator" data-operator="sqrt">√</button>
            <button class="operator" data-operator="%">%</button>
            <button class="operator" data-operator="/">/</button>

            <button class="number">7</button>
            <button class="number">8</button>
            <button class="number">9</button>
            <button class="operator" data-operator="*">*</button>

            <button class="number">4</button>
            <button class="number">5</button>
            <button class="number">6</button>
            <button class="operator" data-operator="-">-</button>

            <button class="number">1</button>
            <button class="number">2</button>
            <button class="number">3</button>
            <button class="operator" data-operator="+">+</button>

            <button class="number wide">0</button>
            <button class="number decimal">.</button>
            <button class="equals" id="equals-button">=</button>
        </div>
    </div>

    <script>
        let currentInput = '0';
        let previousInput = '';
        let operator = null;
        let waitingForSecondOperand = false;

        const displayElement = document.getElementById('calculator-display');

        function updateDisplay() {
            displayElement.textContent = currentInput;
        }

        function clear() {
            currentInput = '0';
            previousInput = '';
            operator = null;
            waitingForSecondOperand = false;
            updateDisplay();
        }

        function appendNumber(number) {
            if (currentInput === 'Error') {
                clear(); // Clear error state before new input
            }
            if (waitingForSecondOperand) {
                currentInput = number;
                waitingForSecondOperand = false;
            } else {
                if (number === '.' && currentInput.includes('.')) return;
                if (currentInput === '0' && number !== '.') {
                    currentInput = number;
                } else {
                    currentInput += number;
                }
            }
            updateDisplay();
        }

        function chooseOperation(nextOperator) {
            if (currentInput === 'Error') return; // Cannot operate on error state

            if (operator && waitingForSecondOperand) {
                operator = nextOperator; // Allow changing operator before second operand is entered
                return;
            }

            if (previousInput !== '' && currentInput !== '') {
                calculate(); // If chaining operations, calculate the previous one first
            }

            if (currentInput === '') { // If no number entered yet, treat current 0 as previous
                previousInput = '0';
            } else {
                previousInput = currentInput;
            }

            operator = nextOperator;
            waitingForSecondOperand = true;
            // No updateDisplay() here, currentInput (now previousInput) should stay visible until new number is typed
        }

        function calculate() {
            if (currentInput === 'Error' || previousInput === '' || operator === null) return;

            let result;
            const prev = parseFloat(previousInput);
            const current = parseFloat(currentInput);

            if (isNaN(prev) || isNaN(current)) {
                currentInput = 'Error';
                operator = null;
                previousInput = '';
                waitingForSecondOperand = false;
                updateDisplay();
                return;
            }

            switch (operator) {
                case '+':
                    result = prev + current;
                    break;
                case '-':
                    result = prev - current;
                    break;
                case '*':
                    result = prev * current;
                    break;
                case '/':
                    if (current === 0) {
                        currentInput = 'Error';
                        operator = null;
                        previousInput = '';
                        waitingForSecondOperand = false;
                        updateDisplay();
                        return;
                    }
                    result = prev / current;
                    break;
                default:
                    return;
            }

            // Handle floating point precision and convert to string for display
            currentInput = parseFloat(result.toFixed(10)).toString();
            operator = null;
            previousInput = '';
            waitingForSecondOperand = true; // Ready for a new operation using the result
            updateDisplay();
        }

        function handleSquareRoot() {
            if (currentInput === 'Error') {
                clear();
                return;
            }
            let num = parseFloat(currentInput);
            if (isNaN(num) || num < 0) {
                currentInput = 'Error';
            } else {
                currentInput = parseFloat(Math.sqrt(num).toFixed(10)).toString();
            }
            operator = null; // Unary operation resets operator
            previousInput = ''; // Unary operation resets previous input
            waitingForSecondOperand = true; // Ready for new input or chain operation
            updateDisplay();
        }

        function handlePercentage() {
            if (currentInput === 'Error') {
                clear();
                return;
            }
            let current = parseFloat(currentInput);
            if (isNaN(current)) return;

            if (operator && previousInput !== '') {
                // If an operator and previous number exist (e.g., 100 + 10%)
                let prev = parseFloat(previousInput);
                if (isNaN(prev)) { 
                    currentInput = 'Error';
                    updateDisplay();
                    return;
                }
                let percentageValue = (prev * current) / 100;
                currentInput = percentageValue.toString();
                // Then, trigger calculation to apply the operator with the new currentInput
                calculate();
            } else {
                // No operator, just convert current input to percentage (e.g., 50% -> 0.5)
                currentInput = (current / 100).toString();
                operator = null; // Unary-like operation resets operator
                previousInput = ''; // Unary-like operation resets previous input
                waitingForSecondOperand = true; // Ready for new input or chain operation
                updateDisplay();
            }
        }

        // Event Listeners for button clicks
        document.addEventListener('DOMContentLoaded', () => {
            const buttonsContainer = document.getElementById('calculator-buttons');

            buttonsContainer.addEventListener('click', (event) => {
                const target = event.target;
                if (!target.matches('button')) return; // Ensure only button clicks are handled

                if (target.classList.contains('number')) {
                    appendNumber(target.textContent);
                } else if (target.classList.contains('operator')) {
                    const op = target.dataset.operator;
                    if (op === 'sqrt') {
                        handleSquareRoot();
                    } else if (op === '%') {
                        handlePercentage();
                    } else {
                        chooseOperation(op);
                    }
                } else if (target.classList.contains('equals')) {
                    calculate();
                } else if (target.classList.contains('clear')) {
                    clear();
                }
            });

            updateDisplay(); // Initialize display with '0' when the page loads
        });
    </script>
</body>
</html>